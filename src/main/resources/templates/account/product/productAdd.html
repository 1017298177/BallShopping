<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/style.css"/>
    <link href="/assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/ace.min.css" />
    <link rel="stylesheet" href="/Widget/zTree/css/zTreeStyle/zTreeStyle.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/font-awesome.min.css" />
    <link href="/Widget/icheck/icheck.css" rel="stylesheet" type="text/css" />
    <link href="/Widget/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
    <link href="/plugin/fileinput/fileinput.min.css" rel="stylesheet" type="text/css">
    <link href="/plugin/nprogress/nprogress.css" rel="stylesheet" type="text/css">
    <link href="/css/custom.css" rel="stylesheet" type="text/css">
    <script src="/js/jquery-1.9.1.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
    <script src="/assets/js/typeahead-bs2.min.js"></script>
    <script src="/assets/layer/layer.js" type="text/javascript" ></script>
    <script type="text/javascript" src="/Widget/My97DatePicker/WdatePicker.js"></script>
    <script type="text/javascript" src="/Widget/icheck/jquery.icheck.min.js"></script>
    <script src="/js/lrtk.js" type="text/javascript" ></script>
    <script type="text/javascript" src="/js/H-ui.js"></script>
    <script type="text/javascript" src="/js/H-ui.admin.js"></script>
    <script type="text/javascript" src="/plugin/fileinput/fileinput.min.js" ></script>
    <script type="text/javascript" src="/js/initPage.js" ></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js" type="text/javascript"></script>
    <title>新增商品</title>
</head>
<body>
<div class="clearfix" id="add_picture">
    <div id="scrollsidebar" class="left_Treeview">
        <div class="show_btn" id="rightArrow"><span></span></div>
        <div class="widget-box side_content" >
            <div class="side_title"><a title="隐藏" class="close_btn"><span></span></a></div>
            <div class="side_list">
                <div class="widget-header header-color-green2">
                    <h4 class="lighter smaller">选择产品类型</h4>
                </div>
                <div class="widget-body">
                    <div class="widget-main padding-8">
                        <div  id="treeDemo" class="ztree"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="page_right_style">
        <div class="type_title">添加商品</div>
        <form  class="form form-horizontal" id="form-article-add">
            <div class="clearfix cl">
                <label class="form-label col-2"><span class="c-red">*</span>商品名称：</label>
                <div class="formControls col-10"><input type="text" required="required" class="input-text" value="" placeholder="" id="productName" name="productName"></div>
            </div>
            <div class=" clearfix cl">
                <label class="form-label col-2">商品标题：</label>
                <div class="formControls col-10"><input type="text" required="required" class="input-text" value="" placeholder="" id="productTitle" name="productTitle"></div>
            </div>
            <div class=" clearfix cl">
                <div class="Add_p_s">
                    <label class="form-label col-2">商品库存：</label>
                    <div class="formControls col-2"><input type="text" required="required" class="input-text" value="" placeholder="" id="productStock" name="productStock"></div>
                </div>

                <div class="Add_p_s">
                    <label class="form-label col-2">商品类型：</label>
                    <div class="formControls col-2"><span class="select-box">
				<select class="select" required="required"  id="productType" name="productType">
				</select>
				</span></div>
                </div>
                <div class="Add_p_s">
                    <label class="form-label col-2">品牌：</label>
                    <div class="formControls col-2"><span class="select-box">
				<select class="select" required="required"  id="productBrand" name="productBrand">
				</select>
				</span></div>
                </div>
                <div class="Add_p_s">
                    <label class="form-label col-2">展示价格：</label>
                    <div class="formControls col-2"><input type="text" required="required" class="input-text" value="" placeholder="" id="productPrice" name="productPrice" >元</div>
                </div>
                <div class="Add_p_s">
                    <label class="form-label col-2">市场价格：</label>
                    <div class="formControls col-2"><input type="text" required="required" class="input-text" value="" placeholder="" id="productMarketPrice" name="productMarketPrice" >元</div>
                </div>
            </div>
            <div class="clearfix cl">
                <label class="form-label col-2">商品描述：</label>
                <div class="formControls col-10">
                    <textarea name="productDetail" id="productDetail" required="required" cols="" rows="" class="textarea"  placeholder="说点什么...最少输入5个字符" datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！"  onKeyUp="textarealength(this,200)"></textarea>
                    <p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
                </div>
            </div>
            <div class="clearfix cl">
                <label class="form-label col-2">图片上传：</label>
                <div class="formControls col-10">
                    <div class="uploader-list-container">
                        <div class="queueList">
                            <div id="dndArea" class="placeholder" >
                                <input type="hidden" id="uploadMainImageValue">
                                <input type="file" name="file" title="上传主图片" id="uploadMainImage">
                                <input type="hidden" id="uploadMainImageManyValue">
                                <input type="file" name="file" title="上传主图片的多面" id="uploadMainImageMany">
                                <input type="hidden" id="uploadImageColorValue">
                                <input type="file" name="file" title="上传不同颜色图片" id="uploadImageColor">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clearfix cl">
                <div class="Button_operation">
                    <button onclick="addProduct()" type="button" class="btn btn-primary radius" ><i class="icon-save "></i>保存并提交审核</button>
                    <button class="btn btn-default radius" type="reset">&nbsp;&nbsp;重置&nbsp;&nbsp;</button>
                </div>
            </div>
        </form>
    </div>
</div>
</div>
<script>
    $(function() {
        $("#add_picture").fix({
            float : 'left',
            skin : 'green',
            durationTime :false,
            stylewidth:'220',
            spacingw:0,
            spacingh:260,
        });
    });
    $( document).ready(function(){
//初始化宽度、高度

        $(".widget-box").height($(window).height());
        $(".page_right_style").height($(window).height());
        $(".page_right_style").width($(window).width()-220);
        //当文档窗口发生改变时 触发
        $(window).resize(function(){

            $(".widget-box").height($(window).height());
            $(".page_right_style").height($(window).height());
            $(".page_right_style").width($(window).width()-220);
        });
    });
    $(function(){
        initFileInput()
        initPage("productType","productBrand");
    });


    function initFileInput() {
        $("#uploadMainImage").fileinput({
            uploadUrl: "/api/productImg",
            enctype: 'multipart/form-data',
            previewFileType: "image",
            uploadAsync: true,
            allowedFileExtensions: ["png", "jpg", "jpeg", "ico", "bmp", "gif"],
            maxFileCount: 1,
            maxFileSize: 3072,
            minImageWidth: 50,
            minImageHeight: 50,
            maxImageWidth: 1000,
            maxImageHeight: 1000,
            msgFilesTooMany: "Upload file count({n} - {m})",
            showCaption: false,
            dropZoneEnabled:false,
            showBrowse: true,
            browseClass: "btn btn-primary",
            uploadClass: "btn btn-info",
            removeClass: "btn btn-danger"
        }).on('fileerror', function (event, data, msg) {
            layer.alert("Upload file failed" + msg, {icon: 0});
        }).on('fileuploaded', function (event, data) {
            if (data.response.status == 200) {
                $("#uploadMainImageValue").val(data.response.data);
                $('#uploadPicture').fileinput('disable');
            } else {
                $(".fileinput-remove-button").click()
            }
            layer.alert(data.response.message, {icon: 0});
        }).on('fileclear', function (event) {
        });


        $("#uploadMainImageMany").fileinput({
            uploadUrl: "/api/productImg",
            enctype: 'multipart/form-data',
            previewFileType: "image",
            uploadAsync: true,
            allowedFileExtensions: ["png", "jpg", "jpeg", "ico", "bmp", "gif"],
            maxFileCount: 1,
            maxFileSize: 3072,
            minImageWidth: 50,
            minImageHeight: 50,
            maxImageWidth: 1000,
            maxImageHeight: 1000,
            msgFilesTooMany: "Upload file count({n} - {m})",
            showCaption: false,
            dropZoneEnabled:false,
            showBrowse: true,
            browseClass: "btn btn-primary",
            uploadClass: "btn btn-info",
            removeClass: "btn btn-danger"
        }).on('fileerror', function (event, data, msg) {
            layer.alert("Upload file failed" + msg, {icon: 0});
        }).on('fileuploaded', function (event, data) {
            if (data.response.status == 200) {
              var uploadValue =  $("#uploadMainImageManyValue").val();
              if(uploadValue == null || uploadValue == ""){
                  $("#uploadMainImageManyValue").val(data.response.data);
              }else {
                  $("#uploadMainImageManyValue").val(uploadValue+","+data.response.data);
              }
                $('#uploadPicture').fileinput('disable');
            } else {
                $(".fileinput-remove-button").click()
            }
            layer.alert(data.response.message, {icon: 0});
        }).on('fileclear', function (event) {
        });

        $("#uploadImageColor").fileinput({
            uploadUrl: "/api/productImg",
            enctype: 'multipart/form-data',
            previewFileType: "image",
            uploadAsync: true,
            allowedFileExtensions: ["png", "jpg", "jpeg", "ico", "bmp", "gif"],
            maxFileCount: 1,
            maxFileSize: 3072,
            minImageWidth: 50,
            minImageHeight: 50,
            maxImageWidth: 1000,
            maxImageHeight: 1000,
            msgFilesTooMany: "Upload file count({n} - {m})",
            showCaption: false,
            dropZoneEnabled:false,
            showBrowse: true,
            browseClass: "btn btn-primary",
            uploadClass: "btn btn-info",
            removeClass: "btn btn-danger"
        }).on('fileerror', function (event, data, msg) {
            layer.alert("Upload file failed" + msg, {icon: 0});
        }).on('fileuploaded', function (event, data) {
            if (data.response.status == 200) {
                var colorValue =   $("#uploadImageColorValue").val();
                if (colorValue == null || colorValue == ""){
                    $("#uploadImageColorValue").val(data.response.data);
                }else {
                    $("#uploadImageColorValue").val(colorValue+","+data.response.data);
                }
                $('#uploadPicture').fileinput('disable');
            } else {
                $(".fileinput-remove-button").click()
            }
            layer.alert(data.response.message, {icon: 0});
        }).on('fileclear', function (event) {
        });
    }


    function addProduct() {
        var product = {};
        product.productName = $("#productName").val();
        product.productBrand = $("#productBrand").val();
        product.productDetail = $("#productDetail").val();
        product.productPrice = $("#productPrice").val();
        product.productTitle = $("#productTitle").val();
        product.productType = $("#productType").val();
        product.productStock = $("#productStock").val();
        product.productMarketPrice = $("#productMarketPrice").val();
        product.productMainimage = $("#uploadMainImageValue").val();
        product.productImageMany = $("#uploadMainImageManyValue").val();
        product.productImageColor = $("#uploadImageColorValue").val();
       $.ajax({
           url:"/api/product/productAndImg",
           type:"post",
           contentType:"application/json",
           data:JSON.stringify(product),
           success:function (data) {
               layer.msg(data.message,{icon:1,time:500});
               setTimeout(function () {
                   location.href="/account/product/productList";
               },500)

           }
       })

    }

</script>

</body>
</html>